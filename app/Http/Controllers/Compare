<?php namespace App\Http\Controllers;

use App\Http\Requests;
use App\Http\Controllers\Controller;
use App\Tables\CHSubSurvey;
use App\Tables\analyse;
use App\Tables\MNHSubSurvey;
use Request;
use Input;
use Cache;

  
class Compare extends Controller {


public function getCHV(){

  return 'working';
  
}
public function compareCHV2(){

		 if(Request::ajax()) {
      $data = Input::all();
      $county = $data['county'];
      $fi = $data['fi'];
      $yr = $data['yr'];

     
     if($county =='All'){
     	 $sdata = Cache::remember('CHV2SubSurvey'.$county,180,function(){
      					return CHSubSurvey::all();
      	});  

     }
     	else{

     		 $sdata = Cache::remember('CHV2SubSurvey'.$county,180,function() use ($county){
      					return CHSubSurvey::where('County','Like',$county)->get();
      	});  

     	}

     	

       echo json_encode(analyse::getindividual($fi,$sdata,$county,$yr));
  }

  die;

	}

}